"use strict";const CACHE_NAME="szcache",RESOURCES=[["index.html","update.js"],["manifest.json","favicon.png","icon.png"]];var lastCheckUpdateTime=0;function getResKey(a){var i=(i=registration.scope)||location.origin,a=a.url.substring(i.length);return a=""==(a="/"==a.substring(0,1)?a.substring(1):a)||"/"==a||a.startsWith("#")||a.startsWith("?v=")||a.startsWith("?_=")?"index.html":a}async function reloadAll(){return caches.open(CACHE_NAME).then(r=>{r.keys().then(function(a){a.forEach(function(a,i,s){if(a){var c=a.url.split("/").pop();-1===RESOURCES[1].indexOf(c)&&r.delete(a)}})});var s=registration.scope;RESOURCES[0].forEach(i=>{fetch(s+i).then(a=>{r.put(s+i,a.clone());"index.html"==i&&r.put(s,a.clone())})})}).catch(a=>{caches.delete(CACHE_NAME)})}async function checkUpdate(){try{var a=registration.scope+"update.js",i=await fetch(a,{cache:"reload"}),s=await i.text();if(!s||!s.match(/^\d+$/))return;var c=await caches.open(CACHE_NAME);if(!(i=await c.match(a)))return c.put(a,new Response(s)),void 0;await i.text()!=s&&reloadAll()}catch(a){}}self.addEventListener("fetch",a=>{if("GET"===a.request.method){var i=getResKey(a.request);if(-1!==RESOURCES[1].indexOf(i))return cacheOnly(a);if(-1!==RESOURCES[0].indexOf(i)){if("index.html"==i){i=+new Date;if(36e5<i-lastCheckUpdateTime){lastCheckUpdateTime=i;checkUpdate()}}return cacheFirst(a)}}});self.addEventListener("message",a=>{"skipWaiting"===a.data&&self.skipWaiting()});self.addEventListener("install",a=>a.waitUntil(self.skipWaiting()));self.addEventListener("activate",function(a){return a.waitUntil(async function(){await reloadAll();await self.clients.claim()}())});function cacheOnly(i){return i.respondWith(caches.open(CACHE_NAME).then(a=>a.match(i.request)))}function cacheFirst(s){return s.respondWith(caches.open(CACHE_NAME).then(i=>i.match(s.request).then(a=>a||fetch(s.request).then(a=>{i.put(s.request,a.clone());return a}))))}